import p from '@/parse.vx';

func second(x) => x[1];

RawString := p.Sequence([
  p.Exact('\''),
  p.Many(p.Select([
    p.Filter(p.Char, func(c) => !(c in #['\'', '\\'])),
    p.Transform(p.Exact('\\\''), second),
  ])),
  p.Exact('\''),
]);

String := p.Transform(RawString, func([start, vals, end]) => [
  'literal',
  vals:map(func(v) => v.data):reduce(++)
]);

return String;
